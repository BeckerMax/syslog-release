---
name: syslog_forwarder

templates:
  pre-start.erb: bin/pre-start
  rsyslog.conf.erb: config/rsyslog.conf
  ca_cert.pem.erb: config/ca_cert.pem

consumes:
- name: syslog_storer
  type: syslog_storer
  optional: true

properties:
  address:
    description: IP or DNS address of the syslog server.
    example: logs4.papertrail.com
  port:
    description: Port of the syslog server.
    default: 514
  transport:
    default: udp
    description: One of ["udp", "tcp", "relp"].
  fallback_servers:
    description: "List of fallback servers to be used if the primary syslog server is down. Only tcp or relp protocols are supported. Each list entry should consist of \"address\", \"transport\" and \"port\" keys."
    default: []
    example:
    - address: logs5.papertrail.com
      port: 44312
      transport: tcp

  custom_rule:
    description: Custom rule for syslog event forwarder.
    default: ""

  tls_enabled:
    description: Set this to true to enable TLS.
    default: false
  permitted_peer:
    description: Accepted fingerprint (SHA1) or name of remote peer. Required if TLS is enabled.
    default: ""
    example: "*.papertrail.com"
  ca_cert:
    description: Trust these Certificate Authorities. Required if TLS is enabled.
    example: |
      -----BEGIN CERTIFICATE-----
      MIIClTCCAf4CCQDc6hJtvGB8RjANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMC...
      -----END CERTIFICATE-----
  queue_file_name:
    description: Spill to disk if queue is full
    default: agg_backlog
  queue_max_disk_space:
    description: Max size for disk queue
    default: 128m
  queue_size:
    description: Store no more than this number syslog messages in memory
    default: 100000
  queue_discard_mark:
    description: Purge messages of from memory whose severity is greater than or equal to DiscardSeverity
    default: 97500
  queue_discard_severity:
    description: This discards every message as soon as the discard mark is reached
    default: 0
  queue_low_water_mark:
    description: Num messages. Assuming avg size of 512B, this is 1MiB.
    default: 2000
  queue_high_water_mark:
    description: Num messages. Assuming avg size of 512B, this is 4MiB. (If this is reached, messages will spill to disk until the low watermark is reached).
    default: 80000
  queue_timeout_enqueue:
    description: Discard messages if the queue + disk is full
    default: 0
  queue_save_on_shutdown:
    description: Save in-memory data to disk if rsyslog shuts down. Must be "on" or "off"
    default: on
  resume_interval:
    description: When action is suspended (dest not connected), retry after this number of seconds
    default: 10
  queue_checkpoint_interval:
    description: write bookkeeping information on checkpoints (every n records)
    default: 100
